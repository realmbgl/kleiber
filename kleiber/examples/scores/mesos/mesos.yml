name: core

parameters:
   datacenter: tor01
   domain: mesos.mbgl2.domain
   key: siv

datacenter: "{{ parameters.datacenter }}"

mappings:
   servertypes:
      medium:
         cpus: 4
         memory: 8192
         hourly: True

resources:
   serverinstances:
      masters:
        servertype: medium
        count: 1
        os_code: UBUNTU_LATEST_64
        domain: "{{ parameters.domain }}"
        keyname: "{{ parameters.key }}"
        hostname: "{{ clustername }}-master"
        script: score-files/mesos/config-master.sh

      publicslaves:
        servertype: medium
        count: 1
        os_code: UBUNTU_LATEST_64
        domain: "{{ parameters.domain }}"
        keyname: "{{ parameters.key }}"
        hostname: "{{ clustername }}-slave"
        script: score-files/mesos/config-publicslave.sh
        userdata: '
            {% for master in resources["serverinstances"]["masters"]["vms"] %}
            {{ master["primaryIpAddress"] }}
            {%endfor%}
        '

      privateslaves:
        servertype: medium
        count: 1
        os_code: UBUNTU_LATEST_64
        domain: "{{ parameters.domain }}"
        keyname: "{{ parameters.key }}"
        hostname: "{{ clustername }}-privateslave"
        script: score-files/mesos/config-privateslave.sh
        userdata: '
            {% for master in resources["serverinstances"]["masters"]["vms"] %}
            {{ master["primaryIpAddress"] }}
            {%endfor%}
        '

output:
  template: |
    mesos: "http://{{ resources["serverinstances"]["masters"]["vms"][0]["primaryIpAddress"] }}:5050"
    marathon: "http://{{ resources["serverinstances"]["masters"]["vms"][0]["primaryIpAddress"] }}:8080"

